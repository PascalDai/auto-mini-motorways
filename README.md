# Mini Motorways AI 自动化项目

## 🎯 项目愿景

在本地Mac mini运行Mini Motorways游戏，通过计算机视觉识别游戏画面，将关键信息发送到服务器进行AI决策，最终实现游戏自动化并获得高分。

## 📋 项目整体规划

### 🏗️ 项目架构
```
本地Mac mini (游戏端):
├── 游戏画面捕获系统 ✅
├── 计算机视觉识别系统 🔄
├── 游戏状态分析系统 ⏳
├── 游戏控制系统 ⏳
└── 网络通信客户端 ⏳

远程服务器 (AI决策端):
├── 游戏状态接收模块 ⏳
├── 强化学习AI引擎 ⏳
├── 策略优化算法 ⏳
└── 决策返回接口 ⏳
```

### 📊 开发阶段规划

## 🚀 第一阶段：本地游戏捕获系统 ✅ 已完成

### 1.1 游戏画面精确捕获 ✅ 完成
- [x] **多屏幕环境支持** - 完美识别多显示器设置
- [x] **智能窗口识别** - 自动找到Mini Motorways游戏窗口
- [x] **动态窗口跟踪** - 支持游戏窗口位置变化
- [x] **高效画面捕获** - 仅捕获游戏内容，避免全屏截图
- [x] **权限管理系统** - 自动处理macOS屏幕录制权限
- [x] **文件管理系统** - 自动命名、时间戳、PNG格式保存

**技术实现：**
- 使用AppleScript精确识别游戏窗口
- PyAutoGUI实现高效屏幕捕获
- 支持1920x1049分辨率游戏窗口
- 平均文件大小1.5MB，质量优异

**测试结果：** 100%成功率，支持窗口任意位置移动

---

## 🔍 第二阶段：计算机视觉识别系统 🔄 开发中

### 2.1 游戏状态识别 ✅ 已完成
- [x] **主界面识别** - 100%准确识别游戏主界面
- [x] **颜色分析系统** - HSV颜色空间分析
- [x] **图像特征提取** - 明度、饱和度、颜色分布分析
- [x] **实时状态监控** - 动态游戏状态跟踪

### 2.2 UI元素检测 🆕 已完成
- [x] **游玩按钮识别** - 精确识别青绿色"游玩"按钮，准确率99%+
- [x] **城市选择区域识别** - 自动识别关卡选择界面
- [x] **菜单按钮识别** - UI导航元素检测
- [x] **位置验证系统** - 基于预期位置的元素验证
- [x] **置信度评估** - 检测结果可靠性评分
- [x] **自适应尺寸检测** - 动态调整检测参数以适应不同UI元素

### 2.3 自动游戏启动 🆕 已完成
- [x] **智能界面导航** - 从主界面自动进入游戏
- [x] **自动关卡选择** - 预设城市选择策略
- [x] **游戏控制系统** - 鼠标点击和键盘操作
- [x] **人类行为模拟** - 随机偏移和自然操作节奏
- [x] **紧急停止机制** - 安全操作中断功能

### 2.4 基础图像处理 ⏳ 计划中
- [ ] **游戏界面元素识别**
  - [ ] 房子（住宅区）识别和分类
  - [ ] 公司（目的地）识别和分类
  - [ ] 道路网络识别
  - [ ] 车辆位置和状态识别
- [ ] **UI元素识别**
  - [ ] 分数显示识别
  - [ ] 资源数量识别（道路、桥梁等）
  - [ ] 时间进度识别
  - [ ] 游戏状态识别（暂停/运行）

### 2.5 游戏状态分析 ⏳ 计划中
- [ ] **交通流量分析**
  - [ ] 拥堵区域检测
  - [ ] 车辆排队长度计算
  - [ ] 交通效率评估
- [ ] **地图布局分析**
  - [ ] 可建设区域识别
  - [ ] 最优路径计算
  - [ ] 瓶颈点识别

### 2.6 数据结构化 ⏳ 计划中
- [ ] **游戏状态JSON格式化**
- [ ] **实时数据更新机制**
- [ ] **历史数据存储**

**技术栈：** OpenCV + scikit-image + 自定义图像识别算法

---

## 🌐 第三阶段：网络通信系统 ⏳ 计划中

### 3.1 本地客户端 ⏳ 计划中
- [ ] **HTTP/WebSocket客户端**
- [ ] **数据压缩和传输**
- [ ] **网络异常处理**
- [ ] **离线模式支持**

### 3.2 服务器接口 ⏳ 计划中
- [ ] **RESTful API设计**
- [ ] **实时数据接收**
- [ ] **决策结果返回**
- [ ] **负载均衡处理**

**技术栈：** Python requests + WebSocket + JSON

---

## 🎮 第四阶段：游戏控制系统 ⏳ 计划中

### 4.1 基础控制 ⏳ 计划中
- [ ] **鼠标点击控制**
- [ ] **拖拽操作控制**
- [ ] **键盘快捷键控制**
- [ ] **游戏暂停/继续控制**

### 4.2 高级操作 ⏳ 计划中
- [ ] **道路建设自动化**
- [ ] **桥梁建设自动化**
- [ ] **隧道建设自动化**
- [ ] **交通灯设置自动化**

### 4.3 安全机制 ⏳ 计划中
- [ ] **操作速度限制**
- [ ] **异常情况处理**
- [ ] **手动干预机制**

**技术栈：** PyAutoGUI + 自定义控制算法

---

## 🧠 第五阶段：AI决策引擎 ⏳ 计划中

### 5.1 强化学习模型 ⏳ 计划中
- [ ] **DQN (Deep Q-Network) 实现**
- [ ] **PPO (Proximal Policy Optimization) 实现**
- [ ] **A3C (Asynchronous Actor-Critic) 实现**
- [ ] **模型训练和优化**

### 5.2 策略算法 ⏳ 计划中
- [ ] **蒙特卡洛树搜索 (MCTS)**
- [ ] **遗传算法优化**
- [ ] **启发式算法**
- [ ] **多策略融合**

### 5.3 学习系统 ⏳ 计划中
- [ ] **经验回放机制**
- [ ] **在线学习能力**
- [ ] **策略评估系统**
- [ ] **模型版本管理**

**技术栈：** TensorFlow/PyTorch + 强化学习框架

---

## 🔧 第六阶段：系统集成与优化 ⏳ 计划中

### 6.1 性能优化 ⏳ 计划中
- [ ] **图像处理加速**
- [ ] **网络传输优化**
- [ ] **内存使用优化**
- [ ] **CPU使用优化**

### 6.2 稳定性提升 ⏳ 计划中
- [ ] **异常恢复机制**
- [ ] **日志记录系统**
- [ ] **监控告警系统**
- [ ] **自动重启机制**

### 6.3 用户界面 ⏳ 计划中
- [ ] **Web控制面板**
- [ ] **实时状态监控**
- [ ] **参数调节界面**
- [ ] **统计分析面板**

---

## 📁 当前目录结构

```
auto-mini-motorways/
├── README.md                 # 项目说明文档
├── requirements.txt          # Python依赖包
├── install.sh               # 自动安装脚本
├── start_test.sh            # 快速测试脚本
├── start_auto_launch.sh     # 自动启动测试脚本 🆕
├── src/                     # 源代码目录
│   ├── config.py           # 配置文件
│   ├── window_finder.py    # 窗口查找模块 ✅
│   ├── game_capture.py     # 游戏画面捕获模块 ✅
│   ├── image_analyzer.py   # 图像分析模块 ✅
│   ├── ui_detector.py      # UI元素检测模块 🆕
│   ├── game_controller.py  # 游戏控制模块 🆕
│   ├── auto_game_launcher.py # 自动启动管理器 🆕
│   ├── capture_test.py     # 画面捕获测试脚本 ✅
│   ├── window_test.py      # 窗口识别测试脚本 ✅
│   ├── auto_launch_test.py # 自动启动测试脚本 🆕
│   └── quick_auto_launch_test.py # 快速自动启动测试 🆕
├── data/                   # 数据存储目录
│   └── screenshots/        # 截图存储目录
└── logs/                   # 日志文件目录
```

## 🚀 快速开始

### 环境要求
- **操作系统**: macOS 10.15+
- **Python版本**: 3.8+
- **游戏**: Mini Motorways (Steam/Epic Games/App Store)
- **硬件**: 支持多屏幕环境

### 安装步骤

1. **克隆项目**
```bash
cd ~/Downloads
git clone <项目地址> auto-mini-motorways
cd auto-mini-motorways
```

2. **自动安装环境**
```bash
./install.sh
```

3. **测试窗口识别**
```bash
./start_test.sh
# 或者
source venv/bin/activate
python3 src/window_test.py
```

4. **运行完整测试**
```bash
source venv/bin/activate
python3 src/capture_test.py
```

5. **测试自动启动功能** 🆕
```bash
./start_auto_launch.sh
```

### 使用说明

1. **首次运行**: 需要在系统设置中授权屏幕录制权限
2. **游戏准备**: 确保Mini Motorways游戏已打开且窗口可见
3. **测试流程**: 
   - 运行窗口识别测试确认游戏窗口能被找到
   - 运行完整捕获测试验证截图功能
   - 检查 `data/screenshots/` 目录中的截图质量

## 📊 当前进度状态

### ✅ 已完成功能
- **游戏窗口智能识别** - 支持多屏幕环境
- **动态窗口位置跟踪** - 窗口移动自动适应
- **高质量画面捕获** - 1920x1049分辨率
- **游戏状态识别** - 100%准确识别主界面
- **UI元素检测** - 智能识别按钮和交互元素
- **自动游戏启动** - 从主界面自动进入游戏 🆕
- **游戏控制系统** - 鼠标点击和键盘操作 🆕
- **完善的测试框架** - 多层次测试系统
- **用户友好的安装流程** - 一键安装脚本

### 🔄 正在开发
- **游戏内元素识别** - 房屋、道路、车辆检测
- **交通流量分析** - 拥堵检测和效率评估

### ⏳ 计划开发
- **网络通信模块** - 本地-服务器数据传输
- **游戏控制系统** - 自动化操作
- **AI决策引擎** - 强化学习算法
- **Web管理界面** - 实时监控和控制

## 🎯 里程碑目标

- **第一阶段目标** ✅: 稳定的游戏画面捕获 (已完成)
- **第二阶段目标** ✅: 准确的游戏状态识别 (已完成)
- **第三阶段目标** ⏳: 本地-服务器通信建立
- **第四阶段目标** ⏳: 基础游戏自动化操作
- **第五阶段目标** ⏳: AI智能决策系统
- **最终目标** 🎯: 完全自动化高分游戏系统

## 🛠️ 技术栈总览

**本地端技术:**
- **Python 3.13** - 主要编程语言
- **PyAutoGUI** - 屏幕捕获和控制
- **OpenCV** - 图像处理
- **Pillow** - 图像操作
- **AppleScript** - macOS窗口管理

**服务器端技术 (计划):**
- **Python/FastAPI** - Web服务框架
- **TensorFlow/PyTorch** - 深度学习框架
- **Redis** - 数据缓存
- **PostgreSQL** - 数据存储

## 📞 开发状态

**当前版本**: v0.2.0 (第二阶段完成)  
**最后更新**: 2025-01-28  
**开发状态**: 积极开发中  

---

*这是一个逐步迭代的项目，每个阶段都会经过充分测试后再进入下一阶段。当前专注于建立稳定可靠的基础功能。* 